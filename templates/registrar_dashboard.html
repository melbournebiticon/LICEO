{% extends "base.html" %}

{% block title %}Registrar{% endblock %}

{% block styles %}
<style>
  /* Card + table styling (compatible with your base) */
  .card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 14px;
    box-shadow: 0 2px 10px rgba(2, 6, 23, .06);
    overflow: hidden;
  }

  .card-header {
    padding: 14px 16px;
    font-weight: 900;
    border-bottom: 1px solid var(--border);
    background: #f8fafc;
  }

  table {
    width: 100%;
    border-collapse: collapse;
  }

  th,
  td {
    padding: 12px 12px;
    border-bottom: 1px solid var(--border);
    text-align: left;
    vertical-align: top;
    font-size: 14px;
  }

  th {
    color: var(--muted);
    font-weight: 900;
    font-size: 13px;
    text-transform: uppercase;
    letter-spacing: .02em;
    background: #fbfdff;
  }

  .badge {
    display: inline-block;
    padding: 4px 10px;
    border-radius: 999px;
    font-size: 12px;
    font-weight: 900;
    border: 1px solid var(--border);
    background: #fff;
  }

  .badge-approved {
    border-color: rgba(46, 125, 50, .35);
  }

  .badge-rejected {
    border-color: rgba(198, 40, 40, .35);
  }

  .badge-pending {
    border-color: rgba(21, 101, 192, .35);
  }

  /* Buttons small */
  .btn-sm {
    padding: 8px 12px;
    border-radius: 10px;
    font-size: 13px;
  }

  .btn-success {
    background: #16a34a;
    color: #fff;
    border: none;
  }

  .btn-success:hover {
    filter: brightness(.95);
    transform: translateY(-1px);
  }

  .btn-danger {
    background: #dc2626;
    color: #fff;
    border: none;
  }

  .btn-danger:hover {
    filter: brightness(.95);
    transform: translateY(-1px);
  }

  .btn-secondary {
    background: #334155;
    color: #fff;
    border: none;
  }

  .btn-secondary:hover {
    filter: brightness(.95);
    transform: translateY(-1px);
  }

  .docs a {
    color: #1d4ed8;
    text-decoration: none;
    font-weight: 700;
  }

  .docs a:hover {
    text-decoration: underline;
  }

  .muted-note {
    color: var(--muted);
    font-size: 12px;
    font-weight: 700;
  }
</style>
{% endblock %}

{% block content %}

<div
  style="display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap; margin-bottom:12px;">
  <h2 style="margin:0;">Registrar</h2>

  <div style="display:flex; gap:8px; flex-wrap:wrap;">
    <a href="/change-password" class="btn btn-secondary btn-sm">Change Password</a>
    <a href="/logout" class="btn btn-dark btn-sm">Logout</a>
  </div>
</div>

<div class="card">
  <div class="card-header">Enrollments</div>

  <div style="overflow:auto;">
    <table>
      <tr>
        <th>ID</th>
        <th>Student Name</th>
        <th>Grade Level</th>
        <th>Documents</th>
        <th>Status</th>
        <th>Action</th>
      </tr>

      {% for enrollment in enrollments %}
      <tr>
        <td>{{ enrollment.enrollment_id }}</td>
        <td>{{ enrollment.student_name }}</td>
        <td>{{ enrollment.grade_level }}</td>

        <td class="docs">
          {% if enrollment.documents and enrollment.documents|length > 0 %}
          {% for doc in enrollment.documents %}
          <a href="{{ doc.file_path }}" target="_blank">{{ doc.file_name }}</a><br>
          {% endfor %}
          {% else %}
          <span class="muted-note">No documents</span>
          {% endif %}
        </td>

        <td>
          {% if enrollment.status == 'approved' %}
          <span class="badge badge-approved">Approved</span>
          {% elif enrollment.status == 'rejected' %}
          <span class="badge badge-rejected">Rejected</span>
          {% else %}
          <span class="badge badge-pending">Pending</span>
          {% endif %}
        </td>

        <td>
          {% if enrollment.status == 'pending' %}
          <form method="post" style="display:inline">
            <input type="hidden" name="enrollment_id" value="{{ enrollment.enrollment_id }}">
            <button name="action" value="approved" class="btn btn-success btn-sm">Approve</button>
          </form>

          <form method="post" style="display:inline">
            <input type="hidden" name="enrollment_id" value="{{ enrollment.enrollment_id }}">
            <button name="action" value="rejected" class="btn btn-danger btn-sm"
              onclick="return confirm('Reject this enrollment?')">
              Reject
            </button>
          </form>

          {% elif enrollment.status == 'approved' %}
          {% if not enrollment.has_student_account %}
          <form method="post" action="/registrar/create-student-account/{{ enrollment.enrollment_id }}"
            style="display:inline">
            <button type="submit" class="btn btn-primary btn-sm">Create Student Account</button>
          </form>
          {% else %}
          <span style="color:#10b981; font-weight:900;">✓ Student Account Created</span>
          {% endif %}

          <br><br>

          {% if not enrollment.has_parent_account %}
          <form method="post" action="/registrar/create-parent-account/{{ enrollment.enrollment_id }}"
            style="display:inline">
            <button type="submit" class="btn btn-secondary btn-sm">Create Parent Account</button>
          </form>
          {% else %}
          <span style="color:#10b981; font-weight:900;">✓ Parent Account Created</span>
          {% endif %}

          {% else %}
          Done
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </table>
  </div>
</div>

{% endblock %}