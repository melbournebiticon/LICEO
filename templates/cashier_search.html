{% extends "base.html" %}
{% block title %}Search Student{% endblock %}
{% block page_title %}ğŸ” Search Student{% endblock %}

{% block content %}
<div style="max-width:1000px;">

    <div class="card">
        <form method="POST" style="display:flex; gap:10px; flex-wrap:wrap;">
            <input type="text" name="search_query" class="form-input"
                placeholder="Enter Enrollment ID or Student Name..." value="{{ search_query }}" required autofocus
                style="flex:1; min-width:220px;">
            <button type="submit" class="btn btn-primary">ğŸ” Search</button>
            <a href="/cashier" class="btn btn-secondary">âœ• Cancel</a>
        </form>
        <p style="margin-top:10px; color:var(--muted); font-size:0.82rem;">
            ğŸ’¡ Search by exact Enrollment ID (e.g. 1001) or partial student name.
        </p>
    </div>

    {% if search_query %}
    {% if results %}
    <div class="card" style="padding:0; overflow:hidden;">
        <div style="padding:14px 20px; border-bottom:1px solid var(--border); font-weight:700;">
            Results ({{ results|length }})
        </div>
        <div class="table-wrap" style="border:none; border-radius:0;">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Student Name</th>
                        <th>Grade</th>
                        <th>Guardian</th>
                        <th>Bill Status</th>
                        <th>Balance</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for e in results %}
                    <tr>
                        <td>{{ e.enrollment_id }}</td>
                        <td><strong>{{ e.student_name }}</strong></td>
                        <td>Grade {{ e.grade_level }}</td>
                        <td>{{ e.guardian_name or 'â€”' }}</td>
                        <td>
                            {% if not e.bill_id %}<span class="badge badge-gray">No Bill</span>
                            {% elif e.bill_status == 'paid' %}<span class="badge badge-green">âœ“ Paid</span>
                            {% elif e.bill_status == 'partial' %}<span class="badge badge-blue">Partial</span>
                            {% else %}<span class="badge badge-red">Pending</span>{% endif %}
                        </td>
                        <td>{% if e.balance %}â‚±{{ "%.2f"|format(e.balance) }}{% else %}â€”{% endif %}</td>
                        <td>
                            <div style="display:flex; gap:6px;">
                                {% if not e.bill_id %}
                                <a href="/cashier/create-bill/{{ e.enrollment_id }}" class="btn btn-primary btn-sm">ğŸ“
                                    Create Bill</a>
                                {% else %}
                                <a href="/cashier/bill/{{ e.bill_id }}" class="btn btn-secondary btn-sm">ğŸ‘ View</a>
                                {% if e.bill_status != 'paid' %}
                                <a href="/cashier/process-payment/{{ e.bill_id }}" class="btn btn-primary btn-sm">ğŸ’µ
                                    Pay</a>
                                {% endif %}{% endif %}
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% else %}
    <div class="card" style="text-align:center; padding:40px; color:var(--muted);">
        ğŸ˜• No results found for "<strong>{{ search_query }}</strong>"
    </div>
    {% endif %}
    {% endif %}

    <a href="/cashier" class="btn btn-secondary" style="margin-top:8px;">â¬… Back to Dashboard</a>
</div>
{% endblock %}