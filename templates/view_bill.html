{% extends "base.html" %}

{% block title %}View Bill{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">Bill Details</div>
    
    <!-- Student Information -->
    <div style="margin-bottom: 2rem; padding: 1rem; background: #f9fafb; border-radius: 6px;">
        <h3 style="margin-bottom: 0.5rem;">Student Information</h3>
        <div class="grid grid-2">
            <div>
                <p><strong>Name:</strong> {{ bill.student_name }}</p>
                <p><strong>Grade Level:</strong> {{ bill.grade_level }}</p>
            </div>
            <div>
                <p><strong>Guardian:</strong> {{ bill.guardian_name }}</p>
                <p><strong>Contact:</strong> {{ bill.contact_number }}</p>
            </div>
        </div>
    </div>
    
    <!-- Bill Information -->
    <h3 style="margin-bottom: 1rem;">Itemized Charges</h3>
    <table style="margin-bottom: 1.5rem;">
        <tr>
            <td>Tuition Fee</td>
            <td class="text-right">₱{{ "%.2f"|format(bill.tuition_fee) }}</td>
        </tr>
        <tr>
            <td>Book Fee</td>
            <td class="text-right">₱{{ "%.2f"|format(bill.books_fee) }}</td>
        </tr>
        <tr>
            <td>Uniform Fee</td>
            <td class="text-right">₱{{ "%.2f"|format(bill.uniform_fee) }}</td>
        </tr>
        {% if bill.other_fees > 0 %}
        <tr>
            <td>Other Fees</td>
            <td class="text-right">₱{{ "%.2f"|format(bill.other_fees) }}</td>
        </tr>
        {% endif %}
        <tr style="font-weight: bold; border-top: 2px solid #333;">
            <td>Total Amount</td>
            <td class="text-right">₱{{ "%.2f"|format(bill.total_amount) }}</td>
        </tr>
        <tr style="font-weight: bold;">
            <td>Amount Paid</td>
            <td class="text-right" style="color: #10b981;">₱{{ "%.2f"|format(bill.amount_paid) }}</td>
        </tr>
        <tr style="font-weight: bold; font-size: 1.1rem;">
            <td>Balance</td>
            <td class="text-right" style="color: {{ 'green' if bill.balance == 0 else '#ef4444' }};">
                ₱{{ "%.2f"|format(bill.balance) }}
            </td>
        </tr>
    </table>
    
    <div style="margin-bottom: 1.5rem;">
        <strong>Status:</strong> 
        {% if bill.status == 'paid' %}
            <span class="badge badge-paid">Paid</span>
        {% elif bill.status == 'partial' %}
            <span class="badge badge-partial">Partially Paid</span>
        {% else %}
            <span class="badge badge-unpaid">Unpaid</span>
        {% endif %}
    </div>
    
    <!-- Payment History -->
    <h3 style="margin-bottom: 1rem; margin-top: 2rem;">Payment History</h3>
    {% if payments %}
    <table>
        <thead>
            <tr>
                <th>Date</th>
                <th>Amount</th>
                <th>Method</th>
                <th>Reference</th>
                <th>Received By</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for payment in payments %}
            <tr>
                <td>{{ payment.payment_date.strftime('%Y-%m-%d %H:%M') }}</td>
                <td>₱{{ "%.2f"|format(payment.amount) }}</td>
                <td>{{ payment.payment_method|title }}</td>
                <td>{{ payment.reference_number or '-' }}</td>
                <td>{{ payment.received_by_name }}</td>
                <td>
                    <a href="{{ url_for('cashier.receipt', payment_id=payment.payment_id) }}" 
                       class="btn btn-secondary btn-sm">View Receipt</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p style="color: #6b7280;">No payments recorded yet</p>
    {% endif %}
    
    <!-- Actions -->
    <div style="margin-top: 2rem; display: flex; gap: 1rem;">
        {% if bill.status != 'paid' %}
            <a href="{{ url_for('cashier.record_payment', bill_id=bill.bill_id) }}" 
               class="btn btn-success">Record Payment</a>
        {% endif %}
        <a href="{{ url_for('cashier.dashboard') }}" class="btn btn-secondary">Back to Dashboard</a>
    </div>
</div>
{% endblock %}
